#/bin/bash

set -e

CFLAGS=${CFLAGS:-}
LLCFLAGS=${LLCFLAGS:-}
S2WASMFLAGS=${S2WASMFLAGS:-}

llvm_root=${llvm_root:-$HOME/llvm-wasm/llvm-build/bin}

outfile=$1
outdir=$(dirname "$outfile")
cfiles=( "${@:2}" )

$llvm_root/clang \
    --target=wasm32-unknown-unknown-wasm \
    -o $outfile \
    -nostartfiles \
    -Wl,--entry=test,--demangle,--allow-undefined-file=src/external.syms \
    ${cfiles[@]}
